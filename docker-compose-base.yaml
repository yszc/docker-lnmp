version: '3'
networks:
  lan_access:
    driver: bridge

services:
  cgi:
    container_name: cgi
    build: ./docker/files/cgi
    tty: true
    restart: always
    expose:
      - "9000"
    volumes:
      - ./www:/data/www
      - ./docker/log/cgi:/var/log/php-fpm
    links:
      - memcached:memcached
    networks:
      - lan_access
      - default
  proxy:
    container_name: proxy
    image: nginx:1.17.9
    tty: true
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./www:/data/www
      - ./docker/config/proxy/conf.d:/etc/nginx/conf.d
      - ./docker/log/proxy:/var/log/nginx
    depends_on:
      - cgi
    links:
      - cgi
    networks:
      - lan_access
      - default
